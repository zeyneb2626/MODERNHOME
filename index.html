<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Configuration Modern'home</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer@1.12.0/dist/model-viewer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    * { box-sizing:border-box; margin:0; padding:0 }
    html, body { min-height:100%; font-family:sans-serif; background:#f0f2f5 }

    .fixed-price {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 1000;
      text-align: center;
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }

    .fixed-price.visible {
      transform: translateY(0);
    }

    .fixed-price-label {
      font-size: 1rem;
      color: #666;
      margin-right: 1rem;
    }

    .fixed-price-amount {
      font-size: 1.5rem;
      font-weight: bold;
      color: #1a202c;
    }

    /* DESKTOP LAYOUT */
    #configurator {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      gap: 0.5rem;
      padding: 1rem;
    }

    /* TOP SECTION - MODÈLE 3D UNIQUEMENT */
    .top-section {
      height: 50vh;
    }

    /* MODÈLE 3D PLEINE LARGEUR */
    .viewer-card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      height: 100%;
      position: relative;
    }

    model-viewer {
      width: 100%;
      height: 100%;
      background: #dddddd;
      pointer-events: all;
      touch-action: pan-x pan-y; /* Permet la rotation du modèle mais empêche le scroll de la page */
    }

    /* FLÈCHES D'INDICATION ROTATION STYLE VOLKSWAGEN */
    .rotation-indicators {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      pointer-events: none;
      z-index: 10;
      opacity: 0.8;
      animation: fadeInOut 4s infinite;
    }

    .rotation-hint {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 20px;
      border-radius: 25px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      font-size: 0.8rem;
      color: #555;
      font-weight: 500;
    }

    .rotation-arrows {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .rotation-arrow {
      width: 24px;
      height: 24px;
      border: 2px solid #1976d2;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #1976d2;
      background: white;
      font-weight: bold;
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    /* BOTTOM SECTION - CONFIGURATION */
    .bottom-section {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 1rem;
      flex: 1;
    }

    .config-header {
      text-align: center;
      margin-bottom: 1rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 0.75rem;
    }

    .config-header h2 {
      font-size: 1.5rem;
      color: #222;
      margin-bottom: 0.5rem;
    }

    .config-header .current-price {
      font-size: 2rem;
      font-weight: bold;
      color: #1a202c;
    }

    .config-content {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 1.5rem;
    }

    /* COLONNE GAUCHE - ÉNERGIE + PLAN + INFOS MAISON */
    .left-column {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* SECTION ÉNERGIE + PLAN CÔTE À CÔTE */
    .energy-plan-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .energy-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
    }

    .energy-section h3 {
      font-size: 1rem;
      color: #222;
      margin-bottom: 0.75rem;
    }

    .energy-visual {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .house-icon {
      width: 40px;
      height: 40px;
      flex-shrink: 0;
    }

    .rating-scale {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .rating-bar {
      display: flex;
      align-items: center;
      height: 16px;
      padding: 0 8px;
      color: white;
      opacity: 0.7;
      font-size: 0.75rem;
      transition: all 0.3s ease;
      clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 50%, calc(100% - 8px) 100%, 0 100%);
      width: 140px;
    }

    .rating-bar.active {
      opacity: 1;
      width: 160px;
      transform: translateX(6px);
      box-shadow: 0 0 12px rgba(0, 106, 255, 0.4);
    }

    .rating-label {
      font-weight: bold;
      margin-right: 6px;
      min-width: 16px;
    }

    .rating-A-plus { background-color: #1B5E20; }
    .rating-A { background-color: #2E7D32; }
    .rating-B { background-color: #388E3C; }
    .rating-C { background-color: #8BC34A; }
    .rating-D { background-color: #FFEB3B; color: #000; }
    .rating-E { background-color: #FFC107; color: #000; }
    .rating-F { background-color: #FF9800; }
    .rating-G { background-color: #F44336; }

    .energy-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }

    .energy-bar {
      width: 100%;
      height: 4px;
      background: #eee;
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .energy-details {
      font-size: 0.75rem;
      color: #555;
      line-height: 1.3;
    }

    /* SECTION PLAN À CÔTÉ DE L'ÉNERGIE */
    .plan-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
    }

    .plan-section h3 {
      font-size: 1rem;
      color: #222;
      margin-bottom: 0.75rem;
      text-align: center;
    }

    .plan-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
    }

    .plan-content img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .plan-fallback {
      text-align: center;
      color: #999;
    }

    .plan-fallback-box {
      width: 100px;
      height: 70px;
      background: #f0f0f0;
      border-radius: 4px;
      margin: 0 auto 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    /* INFOS MAISON */
    .dimensions-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
    }

    .dimensions-section h3 {
      font-size: 1rem;
      color: #222;
      margin-bottom: 0.75rem;
    }

    .dim-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .dim-card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .dim-card strong {
      font-size: 1.1rem;
      color: #222;
    }

    .dim-card span {
      font-size: 0.85rem;
      color: #666;
    }

    /* COLONNE DROITE - CONFIGURATION */
    .right-column {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    /* GRILLE 3x2 POUR LES CONFIGURATIONS */
    .config-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .config-group {
      margin-bottom: 0;
    }

    .config-group h3 {
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
      color: #333;
      font-weight: 600;
    }

    .config-options {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .config-option {
      text-align: center;
      width: 50px;
    }

    .config-swatch {
      width: 50px;
      height: 50px;
      border: 2px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      transform-origin: center;
    }

    .config-swatch:hover { 
      border-color: #999;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .config-swatch.selected { 
      border-color: #006aff;
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0, 106, 255, 0.3);
    }

    .config-swatch.selected::after {
      content: '✔';
      position: absolute;
      top: 2px;
      right: 4px;
      color: #006aff;
      font-size: 1rem;
    }

    .config-option-label {
      font-size: 0.7rem;
      margin-top: 0.25rem;
      line-height: 1.1;
      color: #444;
    }

    .config-option-price {
      font-size: 0.65rem;
      color: #666;
    }

    /* PRIX ET BOUTONS */
    .price-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      margin-top: 0.75rem;
    }

    .price-section h3 {
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
    }

    .price-item {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
      padding: 0.25rem 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .price-item:last-child {
      border-bottom: none;
      font-weight: bold;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 2px solid #ccc;
    }

    /* SECTION EMAIL + BOUTONS */
    .email-section {
      background: #f8fafc;
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      margin-top: 0.75rem;
    }

    .email-input-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .email-input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.85rem;
      transition: border-color 0.3s ease;
    }

    .email-input:focus {
      outline: none;
      border-color: #006aff;
      box-shadow: 0 0 0 3px rgba(0, 106, 255, 0.1);
    }

    .action-buttons {
      display: flex;
      gap: 0.75rem;
    }

    .action-buttons button {
      flex: 1;
      padding: 0.75rem;
      font-size: 0.85rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .action-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-save {
      background: #D4C4A3;
      color: #333;
    }

    .btn-save:hover {
      background: #C4B493;
    }

    .btn-quote {
      background: #006aff;
      color: #fff;
    }

    .btn-quote:hover {
      background: #0056d6;
    }

    .btn-quote:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .btn-quote.loading {
      background: #999;
      cursor: wait;
    }

    .btn-quote.loading::after {
      content: ' ⏳';
    }

    /* RESPONSIVE MOBILE */
    @media (max-width: 768px) {
      #configurator { 
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        gap: 0;
        padding: 0;
      }
      
      .top-section {
        height: 35vh;
        min-height: 250px;
      }
      
      /* MODÈLE 3D EN PLEINE LARGEUR EN HAUT */
      .viewer-card {
        border-radius: 0;
        order: 1;
      }
      
      .rotation-indicators {
        bottom: 10px;
      }
      
      .rotation-hint {
        padding: 8px 16px;
        font-size: 0.7rem;
        gap: 8px;
      }
      
      .rotation-arrow {
        width: 20px;
        height: 20px;
        font-size: 10px;
      }
      
      /* SECTION CONFIGURATION MOBILE */
      .bottom-section {
        border-radius: 0;
        padding: 1rem;
        order: 2;
      }
      
      .config-header h2 {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
      }
      
      .config-header .current-price {
        font-size: 1.4rem;
        margin-bottom: 1rem;
      }
      
      .config-content {
        display: grid;
        grid-template-columns: 1fr 1.2fr;
        gap: 0.75rem;
      }
      
      /* ÉNERGIE + PLAN EN COLONNE SUR MOBILE */
      .energy-plan-section {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
      
      /* COLONNE GAUCHE MOBILE */
      .left-column {
        gap: 0.5rem;
      }
      
      .energy-section {
        padding: 0.5rem;
      }
      
      .energy-section h3 {
        font-size: 0.7rem;
        margin-bottom: 0.4rem;
      }
      
      .energy-visual {
        gap: 0.4rem;
        margin-bottom: 0.4rem;
      }
      
      .house-icon {
        width: 16px;
        height: 16px;
      }
      
      .rating-bar {
        height: 6px;
        padding: 0 3px;
        font-size: 0.4rem;
        clip-path: polygon(0 0, calc(100% - 3px) 0, 100% 50%, calc(100% - 3px) 100%, 0 100%);
        width: 60px;
        gap: 1px;
      }
      
      .rating-bar.active {
        width: 65px;
        transform: translateX(2px);
        box-shadow: 0 0 8px rgba(0, 106, 255, 0.3);
      }
      
      .rating-label {
        margin-right: 1px;
        min-width: 6px;
      }
      
      .energy-info {
        font-size: 0.6rem;
        margin-bottom: 0.15rem;
      }
      
      .energy-bar {
        height: 2px;
        margin-bottom: 0.25rem;
      }
      
      .energy-details {
        font-size: 0.55rem;
        line-height: 1.1;
      }
      
      /* PLAN MOBILE */
      .plan-section {
        padding: 0.5rem;
      }
      
      .plan-section h3 {
        font-size: 0.7rem;
        margin-bottom: 0.4rem;
      }
      
      /* DIMENSIONS MOBILE */
      .dimensions-section {
        padding: 0.5rem;
      }
      
      .dimensions-section h3 {
        font-size: 0.7rem;
        margin-bottom: 0.4rem;
      }
      
      .dim-grid {
        gap: 0.25rem;
      }
      
      .dim-card {
        padding: 0.4rem;
        border-radius: 3px;
      }
      
      .dim-card strong {
        font-size: 0.7rem;
      }
      
      .dim-card span {
        font-size: 0.6rem;
      }
      
      /* COLONNE DROITE MOBILE */
      .right-column {
        gap: 0.4rem;
      }
      
      .config-grid {
        gap: 0.4rem;
        margin-bottom: 0.5rem;
      }
      
      .config-group h3 {
        font-size: 0.6rem;
        margin-bottom: 0.2rem;
      }
      
      .config-options {
        gap: 0.15rem;
      }
      
      .config-option {
        width: 24px;
      }
      
      .config-swatch {
        width: 24px;
        height: 24px;
        border: 1px solid #ccc;
        border-radius: 3px;
      }
      
      .config-swatch.selected::after {
        top: 0px;
        right: 1px;
        font-size: 0.5rem;
      }
      
      .config-option-label {
        font-size: 0.5rem;
        margin-top: 0.1rem;
        line-height: 1;
      }
      
      .config-option-price {
        font-size: 0.45rem;
        line-height: 1;
      }
      
      /* PRIX MOBILE */
      .price-section {
        padding: 0.5rem;
        margin-top: 0.3rem;
      }
      
      .price-section h3 {
        font-size: 0.7rem;
        margin-bottom: 0.4rem;
      }
      
      .price-item {
        font-size: 0.6rem;
        margin-bottom: 0.15rem;
        padding: 0.15rem 0;
      }
      
      .price-item:last-child {
        font-size: 0.65rem;
        margin-top: 0.2rem;
        padding-top: 0.2rem;
        border-top: 1px solid #ccc;
      }
      
      /* EMAIL + BOUTONS MOBILE */
      .email-section {
        padding: 0.5rem;
        margin-top: 0.3rem;
      }
      
      .email-input-group {
        flex-direction: column;
        gap: 0.25rem;
        margin-bottom: 0.4rem;
      }
      
      .email-input {
        padding: 0.4rem;
        font-size: 0.6rem;
      }
      
      .action-buttons {
        flex-direction: column;
        gap: 0.25rem;
      }
      
      .action-buttons button {
        padding: 0.4rem;
        font-size: 0.6rem;
      }
    }

    @keyframes drift {
      0% { transform: translateY(0) translateX(0); opacity: 0.6; }
      50% { transform: translateY(-2px) translateX(2px); opacity: 0.3; }
      100% { transform: translateY(0) translateX(0); opacity: 0.6; }
    }

    .smoke path {
      animation: drift 3s infinite ease-in-out;
    }

    .house-body {
      transition: fill 0.6s ease-in-out, stroke 0.6s ease-in-out;
    }
  </style>
</head>
<body>
  <div class="fixed-price" id="fixed-price">
    <span class="fixed-price-label">Prix TTC</span>
    <span class="fixed-price-amount" id="fixed-price-amount">209 000 €</span>
  </div>

  <div id="configurator">
    <!-- TOP SECTION - MODÈLE 3D UNIQUEMENT -->
    <div class="top-section">
      <div class="viewer-card">
        <model-viewer
          id="mv"
          src="MODERNHOME61.glb"
          alt="Maison Modern'home"
          camera-orbit="15deg 75deg 16m"
          field-of-view="35deg"
          exposure="0.6"
          shadow-intensity="2.5"
          shadow-softness="1"
          camera-controls
          min-camera-orbit="-Infinity 0deg 12m"
          max-camera-orbit="Infinity 90deg 25m"
          camera-target="0m 1m 0m"
          interaction-prompt="none">
        </model-viewer>
        <!-- Flèches d'indication style Volkswagen -->
        <div class="rotation-indicators">
          <div class="rotation-hint">
            <div class="rotation-arrows">
              <div class="rotation-arrow">◀</div>
              <div class="rotation-arrow">▶</div>
            </div>
            <span>Faites glisser pour faire tourner</span>
          </div>
        </div>
      </div>
    </div>

    <!-- BOTTOM SECTION - CONFIGURATION -->
    <div class="bottom-section">
      <!-- TITRE ET PRIX -->
      <div class="config-header">
        <h2>Configuration Modern'home</h2>
        <div class="current-price" id="total-price">209 000 €</div>
      </div>

      <div class="config-content">
        <!-- COLONNE GAUCHE - ÉNERGIE + PLAN + INFOS MAISON -->
        <div class="left-column">
          <!-- ÉNERGIE + PLAN CÔTE À CÔTE -->
          <div class="energy-plan-section">
            <!-- SECTION ÉNERGIE -->
            <div class="energy-section">
              <h3>Performance énergétique</h3>
              <div class="energy-visual">
                <div class="house-icon">
                  <svg class="house-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path
                      class="house-body"
                      d="M20,70 L20,40 L50,15 L80,40 L80,70"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="6"
                      stroke-linejoin="round"
                      stroke-linecap="round"/>
                    <path
                      d="M65,30 L65,20"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="6"
                      stroke-linecap="round"/>
                    <g class="smoke">
                      <path
                        d="M63,17 C67,15 69,13 67,11 M67,12 C71,10 73,8 71,6"
                        fill="none"
                        stroke="#999"
                        stroke-width="1"
                        stroke-linecap="round"/>
                    </g>
                  </svg>
                </div>
                <div class="rating-scale">
                  <div class="rating-bar rating-A-plus" data-rating="A+">
                    <span class="rating-label">A+</span>
                    <span>≤50</span>
                  </div>
                  <div class="rating-bar rating-A" data-rating="A">
                    <span class="rating-label">A</span>
                    <span>51-90</span>
                  </div>
                  <div class="rating-bar rating-B" data-rating="B">
                    <span class="rating-label">B</span>
                    <span>91-150</span>
                  </div>
                  <div class="rating-bar rating-C" data-rating="C">
                    <span class="rating-label">C</span>
                    <span>151-230</span>
                  </div>
                  <div class="rating-bar rating-D" data-rating="D">
                    <span class="rating-label">D</span>
                    <span>231-330</span>
                  </div>
                  <div class="rating-bar rating-E" data-rating="E">
                    <span class="rating-label">E</span>
                    <span>331-450</span>
                  </div>
                  <div class="rating-bar rating-F" data-rating="F">
                    <span class="rating-label">F</span>
                    <span>451-590</span>
                  </div>
                  <div class="rating-bar rating-G" data-rating="G">
                    <span class="rating-label">G</span>
                    <span>>590</span>
                  </div>
                </div>
              </div>
              <div class="energy-info">
                <span>Consommation :</span>
                <span id="energy-value">120 kWh/an</span>
              </div>
              <div class="energy-info">
                <span>Classe :</span>
                <span id="energy-class">B</span>
              </div>
              <div class="energy-bar">
                <div id="energy-bar-fill" style="width: 20%; background: #4caf50; height: 100%;"></div>
              </div>
              <div class="energy-details">
                <span id="energy-details">Configuration de base</span>
              </div>
            </div>

            <!-- SECTION PLAN À CÔTÉ DE L'ÉNERGIE -->
            <div class="plan-section">
              <h3>Plan schématique</h3>
              <div class="plan-content">
                <img 
                  src="./PLAN4.png" 
                  alt="Plan schématique de la maison"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                />
                <div class="plan-fallback" style="display: none;">
                  <div class="plan-fallback-box">Plan</div>
                  <span>Plan schématique</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- INFOS MAISON -->
          <div class="dimensions-section">
            <h3>Informations</h3>
            <div class="dim-grid">
              <div class="dim-card">
                <strong>85 m²</strong>
                <span>Surface</span>
              </div>
              <div class="dim-card">
                <strong>3 Ch</strong>
                <span>Chambres</span>
              </div>
              <div class="dim-card">
                <strong>2 SdE</strong>
                <span>Salles d'eau</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- COLONNE DROITE - CONFIGURATION -->
        <div class="right-column">
          <!-- GRILLE 3x2 POUR LES CONFIGURATIONS -->
          <div class="config-grid">
            
            <!-- Menuiserie -->
            <div class="config-group" data-cat="Menuiserie">
              <h3>Menuiserie</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#FFFFFF" data-color="#FFFFFF" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Blanc</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#2C2C2C" data-color="#2C2C2C" data-cost="2499"></div>
                  <div class="config-option-label">Anthracite</div>
                  <div class="config-option-price">+2499€</div>
                </div>
              </div>
            </div>

            <!-- Gouttière -->
            <div class="config-group" data-cat="Gouttiere">
              <h3>Gouttière</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#FFFFFF" data-color="#FFFFFF" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Blanc</div>
                  <div class="config-option-price">Base</div>
                </div>
              </div>
            </div>

            <!-- Pergola -->
            <div class="config-group" data-cat="Pergola">
              <h3>Pergola</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#FFFFFF" data-color="#FFFFFF" data-cost="8500"></div>
                  <div class="config-option-label">Blanc</div>
                  <div class="config-option-price">+8500€</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#2C2C2C" data-color="#2C2C2C" data-cost="9500"></div>
                  <div class="config-option-label">Anthracite</div>
                  <div class="config-option-price">+9500€</div>
                </div>
              </div>
            </div>

            <!-- Peinture -->
            <div class="config-group" data-cat="Murs">
              <h3>Peinture</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#FFFFFF" data-color="#FFFFFF" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Blanc</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#D4C4A3" data-color="#D4C4A3" data-cost="999"></div>
                  <div class="config-option-label">Beige Wes</div>
                  <div class="config-option-price">+999€</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color: #E6C7B1" data-color="#E6C7B1" data-cost="1499"></div>
                  <div class="config-option-label">Ocre Mojave</div>
                  <div class="config-option-price">+1499€</div>
                </div>
              </div>
            </div>

            <!-- Tôle -->
            <div class="config-group" data-cat="Toit">
              <h3>Tôle</h3>
              <div class="config-options">
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#9BA1A9" data-color="#9BA1A9" data-cost="0" data-base="true"></div>
                  <div class="config-option-label">Gris</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#1A2E3F" data-color="#1A2E3F" data-cost="0"></div>
                  <div class="config-option-label">Bleu ardoise</div>
                  <div class="config-option-price">Base</div>
                </div>
                <div class="config-option">
                  <div class="config-swatch" style="background-color:#C0392B" data-color="#C0392B" data-cost="1800"></div>
                  <div class="config-option-label">Rouge Hibiscus</div>
                  <div class="config-option-price">+1800€</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Prix et boutons -->
          <div class="price-section">
            <h3>Récapitulatif</h3>
            <div id="price-breakdown">
              <div class="price-item">
                <span>Prix de base</span>
                <span>209 000 €</span>
              </div>
              <div class="price-item">
                <span>Total TTC</span>
                <span id="total-price-display">209 000 €</span>
              </div>
            </div>
          </div>

          <!-- Section Email + Boutons -->
          <div class="email-section">
            <div class="email-input-group">
              <input 
                type="email" 
                id="user-email" 
                class="email-input" 
                placeholder="Votre email pour recevoir le devis"
                required
              />
            </div>
            <div class="action-buttons">
              <button class="btn-save" onclick="saveConfiguration()">Enregistrer PDF</button>
              <button class="btn-quote" id="quote-btn" onclick="requestQuote()">Demander un devis</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ⚙️ CONFIGURATION WEBHOOK
    // Remplacez cette URL par votre webhook réel
    const WEBHOOK_URL = 'https://votre-webhook.com/api/devis';
    
    // Configuration des impacts énergétiques par matériau et couleur
    // Plus la couleur est foncée, plus l'impact énergétique est élevé
    const energyImpact = {
      Bardage: {'#D4B285':120,'#8B4513':150,'#3D4C5C':180},
      Toit: {'#9BA1A9':120,'#1A2E3F':150,'#C0392B':180}, // Gris (clair) < Bleu (moyen) < Rouge (foncé)
      Pergola: {'#FFFFFF':120,'#2C2C2C':150},
      Murs: {'#FFFFFF':120,'#D4C4A3':150,'#E6C7B1':180}, // Blanc < Beige < Ocre
      Menuiserie: {'#FFFFFF':120,'#2C2C2C':150}, // Blanc < Anthracite
      Gouttiere: {'#FFFFFF':120}
    };

    // Couleurs pour les classes énergétiques
    const ratingColors = {
      'Aplus': '#1B5E20',
      'A': '#2E7D32',
      'B': '#388E3C',
      'C': '#8BC34A',
      'D': '#FFEB3B',
      'E': '#FFC107',
      'F': '#FF9800',
      'G': '#F44336'
    };

    // Fonction pour déterminer la classe énergétique
    function getEnergyClass(kwh) {
      if(kwh <= 50) return 'Aplus';
      if(kwh <= 90) return 'A';
      if(kwh <= 150) return 'B';
      if(kwh <= 230) return 'C';
      if(kwh <= 330) return 'D';
      if(kwh <= 450) return 'E';
      if(kwh <= 590) return 'F';
      return 'G';
    }

    // Mapping des catégories vers les noms des matériaux dans le modèle 3D
    const targets = {
      Bardage:    ['poutrine01'],
      Menuiserie: ['menu2','menu3','menu4','menu5'],
      Gouttiere:  ['goutieres'],
      Pergola:    ['pergolat'],
      Murs:       ['murs'],
      Toit:       ['toit']
    };

    // Conversion couleur hexadécimale vers RGBA
    function hex2rgba(h) {
      const v = parseInt(h.slice(1), 16);
      return [
        (v >> 16 & 255) / 255,
        (v >> 8 & 255) / 255,
        (v & 255) / 255,
        1
      ];
    }

    // Variables globales
    let selection = {};
    const basePrice = 209000;

    // 📧 FONCTION POUR ENVOYER LE DEVIS VIA WEBHOOK
    async function sendQuoteToWebhook(quoteData) {
      try {
        const response = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(quoteData)
        });

        if (!response.ok) {
          throw new Error(`Erreur HTTP: ${response.status}`);
        }

        const result = await response.json();
        return { success: true, data: result };
      } catch (error) {
        console.error('Erreur lors de l\'envoi du webhook:', error);
        return { success: false, error: error.message };
      }
    }

    // 📋 FONCTION POUR COLLECTER TOUTES LES DONNÉES DE CONFIGURATION
    function getConfigurationData() {
      const emailInput = document.getElementById('user-email');
      const energyValue = document.getElementById('energy-value').textContent;
      const energyClass = document.getElementById('energy-class').textContent;
      
      // Collecter les options sélectionnées
      const selectedOptions = {};
      let totalOptions = 0;
      
      document.querySelectorAll('.config-group').forEach(group => {
        const category = group.dataset.cat;
        const selectedSwatch = group.querySelector('.config-swatch.selected');
        
        if (selectedSwatch) {
          const label = selectedSwatch.nextElementSibling.textContent;
          const cost = parseInt(selectedSwatch.dataset.cost);
          const color = selectedSwatch.dataset.color;
          const isBase = selectedSwatch.dataset.base === 'true';
          
          selectedOptions[category] = {
            label: label,
            cost: cost,
            color: color,
            isBase: isBase
          };
          
          if (cost > 0) {
            totalOptions += cost;
          }
        }
      });

      return {
        // Informations client
        email: emailInput.value.trim(),
        timestamp: new Date().toISOString(),
        
        // Informations maison
        houseInfo: {
          surface: '85 m²',
          bedrooms: 3,
          bathrooms: 2,
          model: 'Modern\'home'
        },
        
        // Configuration sélectionnée
        configuration: selectedOptions,
        
        // Performance énergétique
        energyPerformance: {
          consumption: energyValue,
          class: energyClass,
          details: document.getElementById('energy-details').textContent
        },
        
        // Prix
        pricing: {
          basePrice: basePrice,
          optionsTotal: totalOptions,
          totalPrice: basePrice + totalOptions,
          currency: 'EUR'
        },
        
        // Métadonnées
        metadata: {
          source: 'Configurateur Modern\'home',
          userAgent: navigator.userAgent,
          url: window.location.href
        }
      };
    }

    // 🚀 FONCTION POUR DEMANDER UN DEVIS (AVEC WEBHOOK)
    async function requestQuote() {
      const emailInput = document.getElementById('user-email');
      const quoteBtn = document.getElementById('quote-btn');
      const email = emailInput.value.trim();
      
      // Validation de l'email
      if (!email) {
        alert('Veuillez saisir votre email pour recevoir le devis.');
        emailInput.focus();
        return;
      }
      
      if (!isValidEmail(email)) {
        alert('Veuillez saisir un email valide.');
        emailInput.focus();
        return;
      }
      
      // Désactiver le bouton et afficher le loading
      quoteBtn.disabled = true;
      quoteBtn.classList.add('loading');
      quoteBtn.textContent = 'Envoi en cours...';
      
      try {
        // Collecter toutes les données de configuration
        const configData = getConfigurationData();
        
        // Envoyer via webhook
        const result = await sendQuoteToWebhook(configData);
        
        if (result.success) {
          alert(`✅ Devis envoyé avec succès à ${email} !\n\nVous recevrez votre devis personnalisé dans quelques minutes.`);
          
          // Optionnel: vider le champ email après envoi réussi
          // emailInput.value = '';
        } else {
          throw new Error(result.error || 'Erreur inconnue');
        }
        
      } catch (error) {
        console.error('Erreur lors de l\'envoi du devis:', error);
        alert(`❌ Erreur lors de l'envoi du devis.\n\nVeuillez réessayer ou nous contacter directement.\n\nDétails: ${error.message}`);
      } finally {
        // Réactiver le bouton
        quoteBtn.disabled = false;
        quoteBtn.classList.remove('loading');
        quoteBtn.textContent = 'Demander un devis';
      }
    }

    // Fonction de validation email
    function isValidEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    // Fonction pour enregistrer la configuration en PDF
    function saveConfiguration() {
      try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        
        // Titre principal
        pdf.setFontSize(20);
        pdf.setTextColor(0, 106, 255);
        pdf.text('Configuration Modern\'home', 105, 20, { align: 'center' });
        
        // Date
        pdf.setFontSize(10);
        pdf.setTextColor(100, 100, 100);
        const today = new Date().toLocaleDateString('fr-FR');
        pdf.text(`Générée le ${today}`, 105, 30, { align: 'center' });
        
        let yPos = 50;
        
        // Informations générales
        pdf.setFontSize(14);
        pdf.setTextColor(0, 0, 0);
        pdf.text('Informations générales', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(10);
        pdf.text('Surface: 85 m²', 20, yPos);
        pdf.text('Chambres: 3', 80, yPos);
        pdf.text('Salles d\'eau: 2', 140, yPos);
        yPos += 20;
        
        // Configuration sélectionnée
        pdf.setFontSize(14);
        pdf.text('Configuration sélectionnée', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(10);
        
        // Parcourir toutes les catégories
        document.querySelectorAll('.config-group').forEach(group => {
          const category = group.dataset.cat;
          const selectedSwatch = group.querySelector('.config-swatch.selected');
          
          if (selectedSwatch) {
            const label = selectedSwatch.nextElementSibling.textContent;
            const cost = parseInt(selectedSwatch.dataset.cost);
            
            pdf.text(`${category}: ${label}`, 20, yPos);
            if (cost > 0) {
              pdf.text(`+${cost.toLocaleString('fr-FR')} €`, 120, yPos);
            } else {
              pdf.text('Base', 120, yPos);
            }
            yPos += 6;
          }
        });
        
        yPos += 15;
        
        // Performance énergétique
        const energyValue = document.getElementById('energy-value').textContent;
        const energyClass = document.getElementById('energy-class').textContent;
        
        pdf.setFontSize(14);
        pdf.text('Performance énergétique', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(10);
        pdf.text(`Consommation: ${energyValue}`, 20, yPos);
        pdf.text(`Classe énergétique: ${energyClass}`, 120, yPos);
        yPos += 20;
        
        // Récapitulatif financier
        pdf.setFontSize(14);
        pdf.text('Récapitulatif financier', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(10);
        pdf.text(`Prix de base: ${basePrice.toLocaleString('fr-FR')} €`, 20, yPos);
        yPos += 6;
        
        let totalOptions = 0;
        document.querySelectorAll('.config-group').forEach(group => {
          const selectedSwatch = group.querySelector('.config-swatch.selected');
          if (selectedSwatch) {
            const cost = parseInt(selectedSwatch.dataset.cost);
            if (cost > 0) {
              const category = group.dataset.cat;
              const label = selectedSwatch.nextElementSibling.textContent;
              totalOptions += cost;
              pdf.text(`${category} - ${label}: +${cost.toLocaleString('fr-FR')} €`, 20, yPos);
              yPos += 6;
            }
          }
        });
        
        yPos += 10;
        pdf.setFontSize(12);
        pdf.setTextColor(0, 106, 255);
        pdf.text(`TOTAL TTC: ${(basePrice + totalOptions).toLocaleString('fr-FR')} €`, 20, yPos);
        
        // Télécharger le PDF
        pdf.save(`Configuration_Modernhome_${today.replace(/\//g, '-')}.pdf`);
        
      } catch (error) {
        console.error('Erreur lors de la génération du PDF:', error);
        alert('Erreur lors de la génération du PDF. Veuillez réessayer.');
      }
    }

    // Initialisation au chargement de la page
    window.addEventListener('DOMContentLoaded', () => {
      const mv = document.getElementById('mv');
      const totalEl = document.getElementById('total-price');
      const totalDisplayEl = document.getElementById('total-price-display');
      const fixedPriceEl = document.getElementById('fixed-price-amount');
      const energyEl = document.getElementById('energy-value');
      const classEl = document.getElementById('energy-class');
      const barFill = document.getElementById('energy-bar-fill');
      const ratingBars = document.querySelectorAll('.rating-bar');
      const houseSvg = document.querySelector('.house-svg');
      const fixedPrice = document.getElementById('fixed-price');

      // Masquer les flèches après quelques secondes
      setTimeout(() => {
        const indicators = document.querySelector('.rotation-indicators');
        if (indicators) {
          indicators.style.opacity = '0';
          setTimeout(() => {
            indicators.style.display = 'none';
          }, 1000);
        }
      }, 5000);

      // Gestion du prix fixe au scroll
      window.addEventListener('scroll', () => {
        if (window.scrollY > 100) {
          fixedPrice.classList.add('visible');
        } else {
          fixedPrice.classList.remove('visible');
        }
      });

      // Mise à jour de la performance énergétique
      function updateEnergy() {
        let sum = 120, lines = [];
        Object.entries(selection).forEach(([cat]) => {
          const sw = document.querySelector(`.config-group[data-cat="${cat}"] .config-swatch.selected`);
          if(!sw) return;
          const col = sw.dataset.color;
          const imp = energyImpact[cat][col] || 120;
          sum += (imp - 120);
          if (imp !== 120) {
            const label = sw.nextElementSibling?.textContent || '';
            lines.push(`• ${cat} – ${label}: ${imp>120?'+':''}${imp-120} kWh/an`);
          }
        });

        // Mise à jour de l'affichage énergétique
        if (energyEl) energyEl.textContent = `${sum} kWh/an`;
        
        const cls = getEnergyClass(sum);
        const displayClass = cls === 'Aplus' ? 'A+' : cls;
        
        if (classEl) classEl.textContent = displayClass;
        
        const percentage = Math.min(100, Math.round(sum/590*100));
        if (barFill) {
          barFill.style.width = `${percentage}%`;
          barFill.style.background = ratingColors[cls];
        }

        // Mise à jour des barres de notation avec effet lumineux
        ratingBars.forEach(bar => {
          const rating = bar.dataset.rating;
          const isActive = (rating === 'A+' && cls === 'Aplus') || rating === cls;
          bar.classList.toggle('active', isActive);
        });

        // Changement de couleur de l'icône maison
        if (houseSvg) houseSvg.style.color = ratingColors[cls];
        
        // Mise à jour des détails énergétiques
        const detailsEl = document.getElementById('energy-details');
        if (detailsEl) {
          detailsEl.textContent = lines.length ? lines.join(', ') : 'Configuration de base';
        }
      }

      // Mise à jour du récapitulatif des prix
      function updatePriceBreakdown() {
        let totalOptions = 0;
        const items = [`<div class="price-item"><span>Prix de base</span><span>${basePrice.toLocaleString('fr-FR')} €</span></div>`];
        
        Object.entries(selection).forEach(([cat]) => {
          const sw = document.querySelector(`.config-group[data-cat="${cat}"] .config-swatch.selected`);
          if(!sw) return;
          const cost = +sw.dataset.cost;
          if(cost > 0) {
            totalOptions += cost;
            const label = sw.nextElementSibling?.textContent || '';
            items.push(`
              <div class="price-item">
                <span>${cat} - ${label}</span>
                <span>+${cost.toLocaleString('fr-FR')} €</span>
              </div>
            `);
          }
        });

        items.push(`
          <div class="price-item">
            <span>Total TTC</span>
            <span>${(basePrice + totalOptions).toLocaleString('fr-FR')} €</span>
          </div>
        `);

        // Mise à jour de l'affichage des prix
        const breakdownEl = document.getElementById('price-breakdown');
        if (breakdownEl) breakdownEl.innerHTML = items.join('');
        
        const totalPrice = `${(basePrice + totalOptions).toLocaleString('fr-FR')} €`;
        if (fixedPriceEl) fixedPriceEl.textContent = totalPrice;
        if (totalEl) totalEl.textContent = totalPrice;
        if (totalDisplayEl) totalDisplayEl.textContent = totalPrice;
      }

      // Configuration des gestionnaires d'événements pour les échantillons
      function setupSwatchHandlers() {
        document.querySelectorAll('.config-group').forEach(group => {
          const cat = group.dataset.cat;
          const frags = targets[cat] || [];
          
          group.querySelectorAll('.config-swatch').forEach(sw => {
            sw.addEventListener('click', () => {
              // Retirer la sélection de tous les échantillons de cette catégorie
              document.querySelectorAll(`.config-group[data-cat="${cat}"] .config-swatch`).forEach(x => x.classList.remove('selected'));
              
              // Ajouter la sélection à l'échantillon cliqué
              sw.classList.add('selected');
              selection[cat] = +sw.dataset.cost;
              updatePriceBreakdown();
              
              // Mise à jour du modèle 3D
              const rgba = hex2rgba(sw.dataset.color);
              if (mv.model && mv.model.materials) {
                mv.model.materials.forEach(m => {
                  const name = m.name.toLowerCase();
                  if(frags.some(f => name.includes(f))) {
                    m.pbrMetallicRoughness.setBaseColorFactor(rgba);
                    m.pbrMetallicRoughness.setMetallicFactor(1);
                    m.pbrMetallicRoughness.setRoughnessFactor(1);
                  }
                });
              }
              updateEnergy();
            });
          });
          
          // Auto-sélection de la première option (configuration de base)
          const first = group.querySelector('.config-swatch[data-base="true"]') || group.querySelector('.config-swatch');
          if(first) first.click();
        });
      }

      // Initialisation après le chargement du modèle 3D
      mv.addEventListener('load', () => {
        setupSwatchHandlers();
        updateEnergy();
      });
    });
  </script>
</body>
</html>
