<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Configuration Modern’home</title>
  <script type="module"
          src="https://unpkg.com/@google/model-viewer@1.12.0/dist/model-viewer.min.js">
  </script>
  <style>
    * { box-sizing:border-box; margin:0; padding:0 }
    html, body { height:100%; font-family:sans-serif; background:#f0f2f5 }
    #configurator {
      display:grid;
      grid-template-columns:2fr 1fr;
      height:100vh;
      gap:1rem;
      padding:1rem;
    }
    .viewer-card {
      background:#fff;
      border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      position:relative;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    model-viewer {
      flex:1;
      width:100%; height:100%;
      background:#fafafa;
      pointer-events: all;
      touch-action: none;
    }
    /* — Performance énergétique — */
    .energy-card {
      padding:1rem;
      border-top:1px solid #eee;
      background:#fff;
    }
    .energy-card h3 {
      margin-bottom:0.5rem;
      font-size:1.1rem;
      color:#222;
    }
    .energy-info {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:0.5rem;
      font-size:0.95rem;
    }
    .energy-bar {
      width:100%; height:8px;
      background:#e0e0e0;
      border-radius:4px;
      overflow:hidden;
      margin:0.5rem 0 1rem;
    }
    .energy-bar-fill {
      width:0; height:100%;
      background:#4caf50;
      transition:width .3s;
    }
    #energy-details div {
      font-size:0.85rem;
      margin-bottom:0.2rem;
    }
    /* – dimensions, controls… inchangés – */
    .dimensions {
      display:grid;
      grid-template-columns:repeat(3,1fr);
      background:#fff;
      padding:1rem;
      border-top:1px solid #eee;
      border-radius:0 0 8px 8px;
      gap:1rem;
    }
    .dim-card {
      background:#fff;
      border:1px solid #eee;
      border-radius:6px;
      padding:.75rem;
      text-align:center;
      box-shadow:0 1px 4px rgba(0,0,0,0.05);
    }
    .dim-card strong { display:block; font-size:1.25rem; color:#222; }
    .dim-card span   { font-size:.85rem; color:#666; }

    .controls { /* … inchangé … */ }
    /* (le reste de votre CSS existant pour .controls, .group, .option, etc.) */
  </style>
</head>
<body>

  <div id="configurator">

    <!-- 3D VIEWER + ÉNERGIE + dimensions -->
    <div class="viewer-card">
      <model-viewer
        id="mv"
        src="MODERNHOME9.glb"
        camera-controls
        exposure="1"
        shadow-intensity="1.2"
        shadow-softness="0.8">
      </model-viewer>

      <!-- Performance énergétique -->
      <div class="energy-card">
        <h3>Performance énergétique estimée</h3>
        <div class="energy-info">
          <div>Consommation :</div>
          <div id="energy-value">0 kWh/an</div>
        </div>
        <div class="energy-info">
          <div>Classe :</div>
          <div id="energy-class">—</div>
        </div>
        <div class="energy-bar">
          <div class="energy-bar-fill" id="energy-bar-fill"></div>
        </div>
        <div id="energy-details">
          <!-- Détail par matériau injecté ici -->
        </div>
      </div>

      <!-- Dimensions sous le viewer -->
      <div class="dimensions">
        <div class="dim-card">
          <strong>85 m²</strong>
          <span>Surface</span>
        </div>
        <div class="dim-card">
          <strong>3 Ch</strong>
          <span>Chambres</span>
        </div>
        <div class="dim-card">
          <strong>2 SdE</strong>
          <span>Salles d'eau</span>
        </div>
      </div>
    </div>

    <!-- CONTROLS (inchangés) -->
    <div class="controls">
      <!-- … toute votre partie .controls existante … -->
    </div>
  </div>

  <script>
    // Impact énergétique en kWh/an
    const energyImpact = {
      Toit:      {'#1A2E3F': 3000, '#A6A6A6': 3200, '#C0392B': 3500},
      Pergola:   {'#FFFFFF': -200, '#000000': -300},
      Murs:      {'#FFFFFF': 0, '#D4C4A3': 100, '#E6C7B1': 150},
      Menuiserie:{'#FFFFFF': 0, '#000000': 50},
      Gouttiere: {'#FFFFFF': 0}
    };

    function getEnergyClass(kwh) {
      if (kwh < 2000) return 'A';
      if (kwh < 2500) return 'B';
      if (kwh < 3000) return 'C';
      if (kwh < 3500) return 'D';
      if (kwh < 4000) return 'E';
      return 'F';
    }

    window.addEventListener('DOMContentLoaded', () => {
      const mv        = document.getElementById('mv');
      const energyEl  = document.getElementById('energy-value');
      const classEl   = document.getElementById('energy-class');
      const barFill   = document.getElementById('energy-bar-fill');
      const details   = document.getElementById('energy-details');
      let   selection = {};

      mv.addEventListener('load', () => {
        const mats = mv.model.materials;

        // init première option de chaque groupe
        document.querySelectorAll('.group').forEach(g => {
          const first = g.querySelector('.swatch');
          if (first) first.click();
        });

        // mise à jour énergie
        function updateEnergy() {
          let sum   = 0;
          const lines = [];

          Object.entries(selection).forEach(([cat]) => {
            const swatch = document.querySelector(`.group[data-cat="${cat}"] .swatch.selected`);
            if (!swatch) return;
            const col = swatch.dataset.color;
            const imp = energyImpact[cat]?.[col] ?? 0;
            sum += imp;
            const label = swatch.nextElementSibling.textContent;
            lines.push(`${cat} (${label}) : ${imp>0? '+'+imp: imp} kWh/an`);
          });

          energyEl.textContent = sum.toLocaleString('fr-FR') + ' kWh/an';
          classEl.textContent  = getEnergyClass(sum);
          const pct = Math.min(100, Math.round(sum/4000*100));
          barFill.style.width = pct + '%';

          details.innerHTML = lines
            .map(l => `<div>• ${l}</div>`)
            .join('') || `<i>Aucun matériau sélectionné</i>`;
        }

        // gestion du clic sur chaque couleur
        document.querySelectorAll('.group').forEach(group => {
          const cat = group.dataset.cat;
          group.querySelectorAll('.swatch').forEach(sw => {
            sw.addEventListener('click', () => {
              group.querySelectorAll('.swatch').forEach(x => x.classList.remove('selected'));
              sw.classList.add('selected');
              selection[cat] = +sw.dataset.cost;
              updateEnergy();
            });
          });
        });

        // 1ère maj
        updateEnergy();
      });
    });
  </script>
</body>
</html>

